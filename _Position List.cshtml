@inherits Custom.Hybrid.Razor12
@using ToSic.Razor.Blade;
@using Connect.Koi
<div class="co-container-outer app-jobs2-@CmsContext.Module.Id" @Edit.TagToolbar(Content)>
  <div class="co-container-inner app-jobs2-wrapper">
    @{
      var cats = AsList(Data["Categories"]);

      var positions = AsList(Data["Jobs"]);

      switch (Content.SortOrder as string)
      {
        case "DESC-date-DESC": 
          positions = positions.OrderByDescending(q => q.Priority).ThenByDescending(q => q.Date);
          break;
        case "DESC-id-ASC": 
          positions = positions.OrderByDescending(q => q.Priority).ThenBy(q => q.EntityId);
          break;
        case "DESC-id-DESC": 
          positions = positions.OrderByDescending(q => q.Priority).ThenByDescending(q => q.EntityId);
          break;
        case "DESC-title-ASC": 
          positions = positions.OrderByDescending(q => q.Priority).ThenBy(q => q.Title);
          break;
      }

      var koi = GetService<Connect.Koi.ICss>();
    }

    @Html.Partial("_JobList.PartAdmin.cshtml")

    <div class="po-wrapper sc-element">
      @if(cats.Count() == 0)
      { 
        cats = AsList(Data["Categories"]);
      }

      @if (Settings.UseCategories) {
        <div class="po-categories-list">
          @if (cats.Count() > 1 || cats.Count() == 0) {
            <div  @Koi.Class("all='po-category-button' bs3='btn btn-primary' bs4,oth='btn btn-outline-primary'") data-filter="nofilter">
              @Resources.LabelNoFilter
            </div>
        
            foreach (var c in cats)
            {
              <div @Koi.Class("all='po-category-button sc-element' bs3='btn btn-primary' bs4,oth='btn btn-outline-primary'") data-filter="@c.Key">
                @Edit.Toolbar(c, actions: "edit")
                @c.Name
              </div>
            }
          }
        </div>
      }

      <div @Koi.Class("all='co-container-inner co-navigation co-navigation-431 co-navigation-image po-wrapper-inner' bs3='row' bs4,oth='row'")>
        @foreach (var p in positions)
        {
          var positionCategories = ((IEnumerable<dynamic>)p.Categories).Select(x => x.Key);

          <div @Koi.Class("all='sc-element po-position' bs3='col col-xs-12' bs4,oth='col-12'") data-filterelem="@Json.Encode(positionCategories)">
            @Edit.Toolbar(p)
            
            @if(Text.Has(p.Link))
            {
              @:<a target="_blank" class="co-link-box" title="@p.Name" href="@p.Link">
            }
            
            <div class="row">                            
              <div  @Koi.Class("bs3='col-xs-9' bs4,oth='col-9'")>
                <h3>@p.Name</h3>
                <div class="po-categories-list">
                  <span>@p.Date.ToString("dd.MM.yyyy")</span>
                </div>

                @if(Text.Has(p.Description))
                {
                  <p>@p.Description</p>
                }
                
                <span class="co-link"> @Resources.LabelShowMore&nbsp;<span class="" aria-hidden="true">&rsaquo;</span>
              </div>
              <div @Koi.Class("all='po-categories-container' bs3='col-xs-3' bs4,oth='col-3'")>
                @foreach (var c in p.Categories) {
                  <span>@c.Name</span>
                }
              </div>
            </div>
            @if(Text.Has(p.Link))
            {
              @:</a>
            }
          </div>
        }
      </div>
    </div>
  </div>
</div>


<link rel="stylesheet" href="/Portals/0/2sxc/Content/dist/@(Koi.PickCss("bs3,bs4", "bs3")).css" >
<script src="@App.Path/dist/app-bundle.min.js" data-enableoptimizations="true" ></script>
<script>
  new jobapp.App(@CmsContext.Module.Id);
</script>
